import unittest
import networkx as nx
import matplotlib.pyplot as plt

import sys
sys.path.append("./code")

from plainCode.agente_Q_v_1_1 import AgenteMalware
from plainCode.entorno_malware_v_1_0 import Red

class test_agente_Q_v_1_1(unittest.TestCase):
    
    # Caso de prueba 1: búsqueda de ruta correcto
    #
    # Comprobamos que encuentra una ruta al nodo objetivo
    def test_encuentra_ruta(self): 
        #inicializamos un agente con una red simple y lo entrenamos
        NNODOS = 9
        inicio = 7
        meta = 5
        red = Red(NNODOS, inicio, meta)
        agente = AgenteMalware(red)
        gamma = 0.7
        alpha = 0.9
        agente.entrena_agente(alpha, gamma, 100)

        #obtenemos la ruta desde el nodo 7
        inicio = 7
        ruta, puntuacion = agente.busca_ruta()

        #comprobamos que llega al destino a través de las conexiones existentes
        self.assertEqual(ruta[-1],NNODOS, "Ha llegado al nodo objetivo")
        for i in range(len(ruta)-1):
            self.assertNotEqual(red.obtener_recompensa(ruta[i],ruta[i+1]), -111, "Ha tomado un camino no permitido")
    
if __name__ == '__main__':
    unittest.main()